import streamlit as st
import pandas as pd
from .utils import load_research_notes_metadata, load_week26_structure_data, load_week01_chart_data, load_schedule_stats

def research_dashboard():
    """ì—°êµ¬ ëŒ€ì‹œë³´ë“œ ë©”ì¸ í˜ì´ì§€"""
    st.title("ğŸš€ ì†Œë¶€ì¬ ìš©ì ‘ ê° íŠ¸ë¦¬ ë¡œë´‡ B-LINE ì»¨ì…‰ ì—°êµ¬ ì¢…í•©")
    st.write("---")
    
    st.markdown("""
    ë³¸ ì—°êµ¬ ëŒ€ì‹œë³´ë“œëŠ” ì—ìŠ¤í”¼ì‹œìŠ¤í…œìŠ¤ì—ì„œ ê°œë°œ ì¤‘ì¸ ì†Œë¶€ì¬ ìš©ì ‘ ìë™í™” ë¡œë´‡ ì‹œìŠ¤í…œ (B-LINE ì»¨ì…‰)ì— ëŒ€í•œ
    26ì£¼ê°„ì˜ ì—°êµ¬ ê²°ê³¼ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤. ì¡°ì„ ì†Œì˜ ì†Œí˜• ë¸”ë¡ ë° ë¶€ì¬ ìš©ì ‘ì„ 99% ë¬´ì¸ ìë™í™”í•˜ì—¬
    ìƒì‚°ì„±ì„ í˜ì‹ í•˜ëŠ” ëª©í‘œ ì•„ë˜, 6ê°œì›”ê°„ ê¸°ê³„ ì„¤ê³„ ë° í•´ì„ ì¸¡ë©´ì˜ ê¸°ì´ˆ ì—°êµ¬ê°€ ìˆ˜í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.
    """)

    st.header("âœ¨ ì£¼ìš” ì—°êµ¬ ëª©í‘œ")
    st.markdown("""
    - **ê° íŠ¸ë¦¬ ë¡œë´‡ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ êµ¬ì¶•:** ì „ì²´ ì‹œìŠ¤í…œì˜ ê¸°ëŠ¥ ë° êµ¬ì¡° ì •ì˜.
    - **í•µì‹¬ ê¸°êµ¬ë¶€ ë¶€í’ˆ ì‚¬ì–‘ ê²€í† :** ëª¨í„°, ë² ì–´ë§, LM ê°€ì´ë“œ, ë³¼ìŠ¤í¬ë¥˜, ë™&í”¼ë‹ˆì–¸ ë“± ì£¼ìš” êµ¬ë™ê³„ ë¶„ì„.
    - **êµ¬ì¡°ë¬¼ ê°•ì„± ë° ì•ˆì •ì„± í•´ì„:** íœ ìƒ¤í”„íŠ¸, ì„¸ë“¤, ê±°ë”, ìºë¦¬ì§€, Zì¶• ë¹” ë“± ì£¼ìš” êµ¬ì¡°ë¬¼ì˜ FEA ë¶„ì„.
    - **ì¶©ê²© í•˜ì¤‘ ë° ìˆ˜ëª… í‰ê°€:** ìŠ¤í† í¼ ì¶©ê²©ë ¥, ë™ì  í•˜ì¤‘ ì¡°ê±´ì—ì„œì˜ êµ¬ì¡°ë¬¼ ë‚´êµ¬ì„± ë° ë¶€í’ˆ ìˆ˜ëª… ê²€ì¦.
    - **ìµœì¢… í†µí•© ë³´ê³ ì„œ ì‘ì„±:** 26ì£¼ê°„ì˜ ì—°êµ¬ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ê³  í–¥í›„ ê°œë°œ ì „ëµ ì œì‹œ.
    """)
    st.write("---")

    st.header("ğŸ“Š ì—°êµ¬ ê°œìš” í†µê³„")
    stats = load_schedule_stats()
    
    col1, col2, col3, col4 = st.columns(4)
    with col1:
        st.metric(label="ì´ ì—°êµ¬ ì£¼ì°¨", value=stats["total_weeks"])
    with col2:
        st.metric(label="ì£¼ìš” ê²€í†  ë¶„ì•¼", value=stats["major_fields"])
    with col3:
        st.metric(label="ê²€í†  ë³´ê³ ì„œ í˜ì´ì§€", value=stats["report_pages"])
    with col4:
        st.metric(label="êµ¬ì¡° í•´ì„ ê±´ìˆ˜", value=stats["analysis_count"])

    st.write("---")
    st.subheader("ğŸ’¡ ì—°êµ¬ ì„±ê³¼ ìš”ì•½")
    st.markdown("""
    - ëª¨ë“  ì£¼ìš” ê¸°êµ¬ë¶€ ë° êµ¬ì¡°ë¬¼ì— ëŒ€í•œ **ê°•ì„±, ì•ˆì „ê³„ìˆ˜, ìˆ˜ëª…, ë™ì  í•˜ì¤‘ ëŒ€ì‘ ëŠ¥ë ¥**ì´ ê²€ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.
    - íŠ¹íˆ **ì„¸ë“¤ í”„ë ˆì„ì˜ êµ¬ì¡° ê°œì„ **ì„ í†µí•´ ì•ˆì „ê³„ìˆ˜ê°€ ëŒ€í­ í–¥ìƒë˜ì—ˆìœ¼ë©°, **ê±°ë” ì²˜ì§ëŸ‰ì— ëŒ€í•œ íšŒê·€ì‹**ì„ ë„ì¶œí•˜ì—¬
      ì •ë°€ ì œì–´ ë° ì˜ˆì¸¡ ìœ ì§€ë³´ìˆ˜ ê¸°ë°˜ì„ ë§ˆë ¨í–ˆìŠµë‹ˆë‹¤.
    - ê° ì¶•ë³„ **ëª¨í„° í† í¬ ì—¬ìœ ìœ¨**ê³¼ **êµ¬ë™ê³„ ë¶€í’ˆ ìˆ˜ëª…** ë˜í•œ ì¶©ë¶„í•œ ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.
    """)

    st.subheader("ğŸ“š í•µì‹¬ ì—°êµ¬ ê²°ê³¼ ë°ì´í„° ìš”ì•½ (Week 26 ê¸°ë°˜)")
    
    # Week 26 êµ¬ì¡° ê°•ì„± ë°ì´í„° í‘œì‹œ
    df_structure = load_week26_structure_data()
    if not df_structure.empty:
        st.dataframe(df_structure, use_container_width=True)
        st.caption("â€» Week 26 ì—°êµ¬ë…¸íŠ¸ ê¸°ë°˜ ì£¼ìš” êµ¬ì¡°ë¬¼ í•´ì„ ê²°ê³¼ ìš”ì•½")
    else:
        st.info("Week 26 ì—°êµ¬ë…¸íŠ¸ì—ì„œ 'êµ¬ì¡° ê°•ì„± ë° ë³€ìœ„' ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

    # Week 01 ì‹œìŠ¤í…œ êµ¬ì„± ë¹„ì¤‘ ì°¨íŠ¸
    df_chart = load_week01_chart_data()
    if not df_chart.empty:
        st.bar_chart(df_chart, x='êµ¬ì„±ìš”ì†Œ', y='ë¹„ì¤‘', height=300)
        st.caption("â€» Week 01 ì—°êµ¬ë…¸íŠ¸ ê¸°ë°˜ ì‹œìŠ¤í…œ êµ¬ì„± ë¹„ì¤‘ ì˜ˆì¸¡")
    else:
        st.info("Week 01 ì—°êµ¬ë…¸íŠ¸ì—ì„œ 'ì‹œìŠ¤í…œ êµ¬ì„± ë¹„ì¤‘ ì˜ˆì¸¡' ì°¨íŠ¸ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

    st.write("---")
    
    # ì—°êµ¬ ë…¸íŠ¸ ê°œìš”
    notes_metadata = load_research_notes_metadata()
    if notes_metadata:
        st.subheader("ğŸ“ ì—°êµ¬ ë…¸íŠ¸ ê°œìš”")
        st.info(f"ì´ **{len(notes_metadata)}ì£¼ì°¨**ì˜ ì—°êµ¬ ë…¸íŠ¸ê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")
        
        # ìµœê·¼ 5ì£¼ì°¨ ì—°êµ¬ ë…¸íŠ¸ ë¯¸ë¦¬ë³´ê¸°
        recent_notes = notes_metadata[-5:] if len(notes_metadata) >= 5 else notes_metadata
        st.markdown("**ìµœê·¼ ì—°êµ¬ ë…¸íŠ¸:**")
        for note in recent_notes:
            with st.expander(f"{note['label']}"):
                st.write(note['summary'])
    
    st.info("ğŸ‘ˆ ì™¼ìª½ ë©”ë‰´ì—ì„œ **ì—°êµ¬ ë¬¸ì„œ** ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì—¬ ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
